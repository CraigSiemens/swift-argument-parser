<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    
    <title>Providing Custom Validation| Documentation</title>
    
    <link rel="icon"       href="favicon.ico" />
    <link rel="mask-icon"  href="favicon.svg" color="#333333" />
    <link rel='stylesheet' href='css/site.css' />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/default.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/highlight.min.js"></script>
  </head>
  <body>
    <div id="app">
      <div class="doc-topic">
        <nav role="navigation" class="nav documentation-nav">
  <div class="nav__wrapper">
    <div class="nav__background"></div>
    <div class="nav-content">
      <div class="nav-title">
        <span class="nav-title-link inactive">Documentation</span>
      </div>
      <div class="nav-menu">
        <div class="nav-menu-tray">
          <ul class="nav-menu-items hierarchy">
            
              <li class="nav-menu-item hierarchy-item">
                
                
                  <a href="index.html" class="item">ArgumentParser</a>
                
              </li>
            
              <li class="nav-menu-item hierarchy-item">
                
                  <span class="current item">Providing Custom Validation</span>
                
                
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

<main id="main" role="main" class="main">
  <div class="topictitle">
  <span class="eyebrow">Article</span>
  <h1 class="title">Providing Custom Validation</h1>
</div>

  <div class="container content-grid">
  <div class="description">
    <div class="abstract content">
      Provide helpful feedback to users when things go wrong.
    </div>
  </div>
  
  <!-- The sidebar once we have one: <div class="summary"></div> -->
  
  <div class="primary-content">
    <div class='content'><h2 id='Overview'>Overview</h2><p>While <code>ArgumentParser</code> validates that the inputs given by your user match the requirements and types that you define in each command, there are some requirements that can’t easily be described in Swift’s type system, such as the number of elements in an array, or an expected integer value.</p><h3 id='Validating-Command-Line-Input'>Validating Command-Line Input</h3><p>To validate your commands properties after parsing, implement the <code>validate()</code> method on any <code>ParsableCommand</code> or <code>ParsableArguments</code> type. Throwing an error from the <code>validate()</code> method causes the program to print a message to standard error and exit with an error code, preventing the <code>run()</code> method from being called with invalid inputs.</p><p>Here’s a command that prints out one or more random elements from the list you provide. Its <code>validate()</code> method catches three different errors that a user can make and throws a relevant error for each one.</p><div data-syntax="swift" class="code-listing">
  <div class="container-general">
    <pre><code><span class="code-line-container"><span data-line-number="1" class="code-number" style="display: none;"></span><span class="code-line">struct Select: ParsableCommand {</span></span>
<span class="code-line-container"><span data-line-number="2" class="code-number" style="display: none;"></span><span class="code-line">    @Option var count: Int = 1</span></span>
<span class="code-line-container"><span data-line-number="3" class="code-number" style="display: none;"></span><span class="code-line">    @Argument var elements: [String] = []</span></span>
<span class="code-line-container"><span data-line-number="4" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="5" class="code-number" style="display: none;"></span><span class="code-line">    mutating func validate() throws {</span></span>
<span class="code-line-container"><span data-line-number="6" class="code-number" style="display: none;"></span><span class="code-line">        guard count &gt;= 1 else {</span></span>
<span class="code-line-container"><span data-line-number="7" class="code-number" style="display: none;"></span><span class="code-line">            throw ValidationError(&quot;Please specify a &#39;count&#39; of at least 1.&quot;)</span></span>
<span class="code-line-container"><span data-line-number="8" class="code-number" style="display: none;"></span><span class="code-line">        }</span></span>
<span class="code-line-container"><span data-line-number="9" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="10" class="code-number" style="display: none;"></span><span class="code-line">        guard !elements.isEmpty else {</span></span>
<span class="code-line-container"><span data-line-number="11" class="code-number" style="display: none;"></span><span class="code-line">            throw ValidationError(&quot;Please provide at least one element to choose from.&quot;)</span></span>
<span class="code-line-container"><span data-line-number="12" class="code-number" style="display: none;"></span><span class="code-line">        }</span></span>
<span class="code-line-container"><span data-line-number="13" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="14" class="code-number" style="display: none;"></span><span class="code-line">        guard count &lt;= elements.count else {</span></span>
<span class="code-line-container"><span data-line-number="15" class="code-number" style="display: none;"></span><span class="code-line">            throw ValidationError(&quot;Please specify a &#39;count&#39; less than the number of elements.&quot;)</span></span>
<span class="code-line-container"><span data-line-number="16" class="code-number" style="display: none;"></span><span class="code-line">        }</span></span>
<span class="code-line-container"><span data-line-number="17" class="code-number" style="display: none;"></span><span class="code-line">    }</span></span>
<span class="code-line-container"><span data-line-number="18" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="19" class="code-number" style="display: none;"></span><span class="code-line">    mutating func run() {</span></span>
<span class="code-line-container"><span data-line-number="20" class="code-number" style="display: none;"></span><span class="code-line">        print(elements.shuffled().prefix(count).joined(separator: &quot;\n&quot;))</span></span>
<span class="code-line-container"><span data-line-number="21" class="code-number" style="display: none;"></span><span class="code-line">    }</span></span>
<span class="code-line-container"><span data-line-number="22" class="code-number" style="display: none;"></span><span class="code-line">}</span></span>
</code></pre>
  </div>
</div>
<p>When you provide useful error messages, they can guide new users to success with your command-line tool!</p><div data-syntax="" class="code-listing">
  <div class="container-general">
    <pre><code><span class="code-line-container"><span data-line-number="1" class="code-number" style="display: none;"></span><span class="code-line">% select</span></span>
<span class="code-line-container"><span data-line-number="2" class="code-number" style="display: none;"></span><span class="code-line">Error: Please provide at least one element to choose from.</span></span>
<span class="code-line-container"><span data-line-number="3" class="code-number" style="display: none;"></span><span class="code-line">Usage: select [--count &lt;count&gt;] [&lt;elements&gt; ...]</span></span>
<span class="code-line-container"><span data-line-number="4" class="code-number" style="display: none;"></span><span class="code-line">  See &#39;select --help&#39; for more information.</span></span>
<span class="code-line-container"><span data-line-number="5" class="code-number" style="display: none;"></span><span class="code-line">% select --count 2 hello</span></span>
<span class="code-line-container"><span data-line-number="6" class="code-number" style="display: none;"></span><span class="code-line">Error: Please specify a &#39;count&#39; less than the number of elements.</span></span>
<span class="code-line-container"><span data-line-number="7" class="code-number" style="display: none;"></span><span class="code-line">Usage: select [--count &lt;count&gt;] [&lt;elements&gt; ...]</span></span>
<span class="code-line-container"><span data-line-number="8" class="code-number" style="display: none;"></span><span class="code-line">  See &#39;select --help&#39; for more information.</span></span>
<span class="code-line-container"><span data-line-number="9" class="code-number" style="display: none;"></span><span class="code-line">% select --count 0 hello hey hi howdy</span></span>
<span class="code-line-container"><span data-line-number="10" class="code-number" style="display: none;"></span><span class="code-line">Error: Please specify a &#39;count&#39; of at least 1.</span></span>
<span class="code-line-container"><span data-line-number="11" class="code-number" style="display: none;"></span><span class="code-line">Usage: select [--count &lt;count&gt;] [&lt;elements&gt; ...]</span></span>
<span class="code-line-container"><span data-line-number="12" class="code-number" style="display: none;"></span><span class="code-line">  See &#39;select --help&#39; for more information.</span></span>
<span class="code-line-container"><span data-line-number="13" class="code-number" style="display: none;"></span><span class="code-line">% select --count 2 hello hey hi howdy</span></span>
<span class="code-line-container"><span data-line-number="14" class="code-number" style="display: none;"></span><span class="code-line">howdy</span></span>
<span class="code-line-container"><span data-line-number="15" class="code-number" style="display: none;"></span><span class="code-line">hey</span></span>
</code></pre>
  </div>
</div>
<h2 id='Handling-Post-Validation-Errors'>Handling Post-Validation Errors</h2><p>The <code>ValidationError</code> type is a special <code>ArgumentParser</code> error — a validation error’s message is always accompanied by an appropriate usage string. You can throw other errors, from either the <code>validate()</code> or <code>run()</code> method to indicate that something has gone wrong that isn’t validation-specific. Errors that conform to <code>CustomStringConvertible</code> or <code>LocalizedError</code> provide the best experience for users.</p><div data-syntax="swift" class="code-listing">
  <div class="container-general">
    <pre><code><span class="code-line-container"><span data-line-number="1" class="code-number" style="display: none;"></span><span class="code-line">struct LineCount: ParsableCommand {</span></span>
<span class="code-line-container"><span data-line-number="2" class="code-number" style="display: none;"></span><span class="code-line">    @Argument var file: String</span></span>
<span class="code-line-container"><span data-line-number="3" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="4" class="code-number" style="display: none;"></span><span class="code-line">    mutating func run() throws {</span></span>
<span class="code-line-container"><span data-line-number="5" class="code-number" style="display: none;"></span><span class="code-line">        let contents = try String(contentsOfFile: file, encoding: .utf8)</span></span>
<span class="code-line-container"><span data-line-number="6" class="code-number" style="display: none;"></span><span class="code-line">        let lines = contents.split(separator: &quot;\n&quot;)</span></span>
<span class="code-line-container"><span data-line-number="7" class="code-number" style="display: none;"></span><span class="code-line">        print(lines.count)</span></span>
<span class="code-line-container"><span data-line-number="8" class="code-number" style="display: none;"></span><span class="code-line">    }</span></span>
<span class="code-line-container"><span data-line-number="9" class="code-number" style="display: none;"></span><span class="code-line">}</span></span>
</code></pre>
  </div>
</div>
<p>The throwing <code>String(contentsOfFile:encoding:)</code> initializer fails when the user specifies an invalid file. <code>ArgumentParser</code> prints its error message to standard error and exits with an error code.</p><div data-syntax="" class="code-listing">
  <div class="container-general">
    <pre><code><span class="code-line-container"><span data-line-number="1" class="code-number" style="display: none;"></span><span class="code-line">% line-count file1.swift</span></span>
<span class="code-line-container"><span data-line-number="2" class="code-number" style="display: none;"></span><span class="code-line">37</span></span>
<span class="code-line-container"><span data-line-number="3" class="code-number" style="display: none;"></span><span class="code-line">% line-count non-existing-file.swift</span></span>
<span class="code-line-container"><span data-line-number="4" class="code-number" style="display: none;"></span><span class="code-line">Error: The file “non-existing-file.swift” couldn’t be opened because</span></span>
<span class="code-line-container"><span data-line-number="5" class="code-number" style="display: none;"></span><span class="code-line">there is no such file.</span></span>
</code></pre>
  </div>
</div>
<p>If you print your error output yourself, you still need to throw an error from <code>validate()</code> or <code>run()</code>, so that your command exits with the appropriate exit code. To avoid printing an extra error message, use the <code>ExitCode</code> error, which has static properties for success, failure, and validation errors, or lets you specify a specific exit code.</p><div data-syntax="swift" class="code-listing">
  <div class="container-general">
    <pre><code><span class="code-line-container"><span data-line-number="1" class="code-number" style="display: none;"></span><span class="code-line">struct RuntimeError: Error, CustomStringConvertible {</span></span>
<span class="code-line-container"><span data-line-number="2" class="code-number" style="display: none;"></span><span class="code-line">    var description: String</span></span>
<span class="code-line-container"><span data-line-number="3" class="code-number" style="display: none;"></span><span class="code-line">}</span></span>
<span class="code-line-container"><span data-line-number="4" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="5" class="code-number" style="display: none;"></span><span class="code-line">struct Example: ParsableCommand {</span></span>
<span class="code-line-container"><span data-line-number="6" class="code-number" style="display: none;"></span><span class="code-line">    @Argument var inputFile: String</span></span>
<span class="code-line-container"><span data-line-number="7" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="8" class="code-number" style="display: none;"></span><span class="code-line">    mutating func run() throws {</span></span>
<span class="code-line-container"><span data-line-number="9" class="code-number" style="display: none;"></span><span class="code-line">        if !ExampleCore.processFile(inputFile) {</span></span>
<span class="code-line-container"><span data-line-number="10" class="code-number" style="display: none;"></span><span class="code-line">            // ExampleCore.processFile(_:) prints its own errors</span></span>
<span class="code-line-container"><span data-line-number="11" class="code-number" style="display: none;"></span><span class="code-line">            // and returns `false` on failure.</span></span>
<span class="code-line-container"><span data-line-number="12" class="code-number" style="display: none;"></span><span class="code-line">            throw ExitCode.failure</span></span>
<span class="code-line-container"><span data-line-number="13" class="code-number" style="display: none;"></span><span class="code-line">        }</span></span>
<span class="code-line-container"><span data-line-number="14" class="code-number" style="display: none;"></span><span class="code-line">    }</span></span>
<span class="code-line-container"><span data-line-number="15" class="code-number" style="display: none;"></span><span class="code-line">}</span></span>
</code></pre>
  </div>
</div>
<h2 id='Handling-Transform-Errors'>Handling Transform Errors</h2><p>During argument and option parsing, you can use a closure to transform the command line strings to custom types. If this transformation fails, you can throw a <code>ValidationError</code>; its <code>message</code> property will be displayed to the user.</p><p>In addition, you can throw your own errors. Errors that conform to <code>CustomStringConvertible</code> or <code>LocalizedError</code> provide the best experience for users.</p><div data-syntax="swift" class="code-listing">
  <div class="container-general">
    <pre><code><span class="code-line-container"><span data-line-number="1" class="code-number" style="display: none;"></span><span class="code-line">struct ExampleTransformError: Error, CustomStringConvertible {</span></span>
<span class="code-line-container"><span data-line-number="2" class="code-number" style="display: none;"></span><span class="code-line">  var description: String</span></span>
<span class="code-line-container"><span data-line-number="3" class="code-number" style="display: none;"></span><span class="code-line">}</span></span>
<span class="code-line-container"><span data-line-number="4" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="5" class="code-number" style="display: none;"></span><span class="code-line">struct ExampleDataModel: Codable {</span></span>
<span class="code-line-container"><span data-line-number="6" class="code-number" style="display: none;"></span><span class="code-line">  let identifier: UUID</span></span>
<span class="code-line-container"><span data-line-number="7" class="code-number" style="display: none;"></span><span class="code-line">  let tokens: [String]</span></span>
<span class="code-line-container"><span data-line-number="8" class="code-number" style="display: none;"></span><span class="code-line">  let tokenCount: Int</span></span>
<span class="code-line-container"><span data-line-number="9" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="10" class="code-number" style="display: none;"></span><span class="code-line">  static func dataModel(_ jsonString: String) throws -&gt; ExampleDataModel  {</span></span>
<span class="code-line-container"><span data-line-number="11" class="code-number" style="display: none;"></span><span class="code-line">    guard let data = jsonString.data(using: .utf8) else { throw ValidationError(&quot;Badly encoded string, should be UTF-8&quot;) }</span></span>
<span class="code-line-container"><span data-line-number="12" class="code-number" style="display: none;"></span><span class="code-line">    return try JSONDecoder().decode(ExampleDataModel.self, from: data)</span></span>
<span class="code-line-container"><span data-line-number="13" class="code-number" style="display: none;"></span><span class="code-line">  }</span></span>
<span class="code-line-container"><span data-line-number="14" class="code-number" style="display: none;"></span><span class="code-line">}</span></span>
<span class="code-line-container"><span data-line-number="15" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="16" class="code-number" style="display: none;"></span><span class="code-line">struct Example: ParsableCommand {</span></span>
<span class="code-line-container"><span data-line-number="17" class="code-number" style="display: none;"></span><span class="code-line">  // Reads in the argument string and attempts to transform it to</span></span>
<span class="code-line-container"><span data-line-number="18" class="code-number" style="display: none;"></span><span class="code-line">  // an `ExampleDataModel` object using the `JSONDecoder`. If the</span></span>
<span class="code-line-container"><span data-line-number="19" class="code-number" style="display: none;"></span><span class="code-line">  // string is not valid JSON, `decode` will throw an error and</span></span>
<span class="code-line-container"><span data-line-number="20" class="code-number" style="display: none;"></span><span class="code-line">  // parsing will halt.</span></span>
<span class="code-line-container"><span data-line-number="21" class="code-number" style="display: none;"></span><span class="code-line">  @Argument(transform: ExampleDataModel.dataModel)</span></span>
<span class="code-line-container"><span data-line-number="22" class="code-number" style="display: none;"></span><span class="code-line">  var inputJSON: ExampleDataModel</span></span>
<span class="code-line-container"><span data-line-number="23" class="code-number" style="display: none;"></span><span class="code-line"></span></span>
<span class="code-line-container"><span data-line-number="24" class="code-number" style="display: none;"></span><span class="code-line">  // Specifiying this option will always cause the parser to exit</span></span>
<span class="code-line-container"><span data-line-number="25" class="code-number" style="display: none;"></span><span class="code-line">  // and print the custom error.</span></span>
<span class="code-line-container"><span data-line-number="26" class="code-number" style="display: none;"></span><span class="code-line">  @Option(transform: { throw ExampleTransformError(description: &quot;Trying to write to failOption always produces an error. Input: \($0)&quot;) })</span></span>
<span class="code-line-container"><span data-line-number="27" class="code-number" style="display: none;"></span><span class="code-line">  var failOption: String?</span></span>
<span class="code-line-container"><span data-line-number="28" class="code-number" style="display: none;"></span><span class="code-line">}</span></span>
</code></pre>
  </div>
</div>
<p>Throwing from a transform closure benefits users by providing context and can reduce development time by pinpointing issues quickly and more precisely.</p><div data-syntax="" class="code-listing">
  <div class="container-general">
    <pre><code><span class="code-line-container"><span data-line-number="1" class="code-number" style="display: none;"></span><span class="code-line">% example &#39;{&quot;Bad JSON&quot;}&#39;</span></span>
<span class="code-line-container"><span data-line-number="2" class="code-number" style="display: none;"></span><span class="code-line">Error: The value &#39;{&quot;Bad JSON&quot;}&#39; is invalid for &#39;&lt;input-json&gt;&#39;: dataCorrupted(Swift.DecodingError.Context(codingPath: [], debugDescription: &quot;The given data was not valid JSON.&quot;, underlyingError: Optional(Error Domain=NSCocoaErrorDomain Code=3840 &quot;No value for key in object around character 11.&quot; UserInfo={NSDebugDescription=No value for key in object around character 11.})))</span></span>
<span class="code-line-container"><span data-line-number="3" class="code-number" style="display: none;"></span><span class="code-line">Usage: example &lt;input-json&gt; --fail-option &lt;fail-option&gt;</span></span>
<span class="code-line-container"><span data-line-number="4" class="code-number" style="display: none;"></span><span class="code-line">  See &#39;select --help&#39; for more information.</span></span>
</code></pre>
  </div>
</div>
<p>While throwing standard library or Foundation errors adds context, custom errors provide the best experience for users and developers.</p><div data-syntax="" class="code-listing">
  <div class="container-general">
    <pre><code><span class="code-line-container"><span data-line-number="1" class="code-number" style="display: none;"></span><span class="code-line">% example &#39;{&quot;tokenCount&quot;:0,&quot;tokens&quot;:[],&quot;identifier&quot;:&quot;F77D661C-C5B7-448E-9344-267B284F66AD&quot;}&#39; --fail-option=&quot;Some Text Here!&quot;</span></span>
<span class="code-line-container"><span data-line-number="2" class="code-number" style="display: none;"></span><span class="code-line">Error: The value &#39;Some Text Here!&#39; is invalid for &#39;--fail-option &lt;fail-option&gt;&#39;: Trying to write to failOption always produces an error. Input: Some Text Here!</span></span>
<span class="code-line-container"><span data-line-number="3" class="code-number" style="display: none;"></span><span class="code-line">Usage: example &lt;input-json&gt; --fail-option &lt;fail-option&gt;</span></span>
<span class="code-line-container"><span data-line-number="4" class="code-number" style="display: none;"></span><span class="code-line">  See &#39;select --help&#39; for more information.</span></span>
</code></pre>
  </div>
</div>
</div>
  </div>
</div>

  
  
  <section id='see-also' class='contenttable alt-light'>
  <div class='container'>
    <h2 class='title'>See Also</h2>

    
      <div class="row contenttable-section">
        <div class="col section-title large-3 medium-3 small-12">
          <h3 class="title">Validation and Errors</h3>
        </div>
  
        <div class="col section-content large-9 medium-9 small-12">
          
            <div class="link-block topic">
              
                <a href="ValidationError/index.html" class="link has-adjacent-elements">
                  <code class="decorated-title"><span class='decorator'>struct</span><span class='decorator empty-token'> </span><span class='identifier'>ValidationError</span></code>
                </a>
              
              
              <div class="abstract">
                <div class="content">An error type that is presented to the user as an error with parsing their command-line input.</div>
              </div>
            </div>
          
            <div class="link-block topic">
              
                <a href="CleanExit/index.html" class="link has-adjacent-elements">
                  <code class="decorated-title"><span class='decorator'>struct</span><span class='decorator empty-token'> </span><span class='identifier'>CleanExit</span></code>
                </a>
              
              
              <div class="abstract">
                <div class="content">An error type that represents a clean (i.e. non-error state) exit of the utility.</div>
              </div>
            </div>
          
            <div class="link-block topic">
              
                <a href="ExitCode/index.html" class="link has-adjacent-elements">
                  <code class="decorated-title"><span class='decorator'>struct</span><span class='decorator empty-token'> </span><span class='identifier'>ExitCode</span></code>
                </a>
              
              
              <div class="abstract">
                <div class="content">An error type that only includes an exit code.</div>
              </div>
            </div>
          
        </div>
      </div>
    
  </div>
</section>

</main>

      </div>
    </div>
    <footer class="footer"></footer>
    <script>hljs.highlightAll();</script>
  </body>
</html>
